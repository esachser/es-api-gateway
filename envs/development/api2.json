{
    "transports": [
        {
            "type": "EsHttpTransport",
            "id": "http",
            "parameters": {
                "routeContext": "/api/v2/teste/",
                "routes": {
                    "/": [
                        "GET",
                        "POST"
                    ],
                    "/healthz": [
                        "GET"
                    ]
                }
            },
            "mids": [
                {
                    "type": "EsConditionMiddleware",
                    "data": {
                        "after": true,
                        "conditions": [
                            {
                                "conditionExpression": "ctx.properties.metrics.timems < 3",
                                "mids": [
                                    {
                                        "type": "EsPropertyMiddleware",
                                        "data": {
                                            "name": "response.headers.timemsg",
                                            "value": "Rápido, muito rápido",
                                            "after": true
                                        }
                                    }
                                ]
                            },
                            {
                                "conditionExpression": "true",
                                "mids": [
                                    {
                                        "type": "EsPropertyMiddleware",
                                        "data": {
                                            "name": "response.headers.timemsg",
                                            "value": "Demorou, hein",
                                            "after": true
                                        }
                                    }
                                ]
                            }
                        ]
                    }
                },
                {
                    "type": "EsPropertyMiddleware",
                    "data": {
                        "name": "response.headers.responsetime",
                        "expression": "ctx.properties.metrics.timems",
                        "after": true
                    }
                },
                {
                    "type": "EsMetricsMiddleware",
                    "data": {
                        "prop": "metrics.timems"
                    }
                },
                {
                    "type": "EsPropertyMiddleware",
                    "data": {
                        "name": "response.body",
                        "expression": "{ 'var': ctx.properties.var3 }",
                        "after": true
                    }
                },
                {
                    "type": "EsPropertyMiddleware",
                    "data": {
                        "name": "response.status",
                        "value": 200,
                        "after": true
                    }
                }
            ]
        }
    ],
    "execution": [
        {
            "type": "EsSequenceMiddleware",
            "data": {
                "mids": [
                    {
                        "type": "EsPropertyMiddleware",
                        "data": {
                            "name": "var1",
                            "expression": "1",
                            "after": true
                        }
                    },
                    [
                        {
                            "type": "EsPropertyMiddleware",
                            "data": {
                                "name": "var2",
                                "expression": "(ctx.properties.var1 || 0) * (ctx.properties.var4 || 1)",
                                "after": true
                            }
                        },
                        {
                            "type": "EsPropertyMiddleware",
                            "data": {
                                "name": "var4",
                                "expression": "3",
                                "after": false
                            }
                        }
                    ],
                    {
                        "type": "EsPropertyMiddleware",
                        "data": {
                            "name": "var3",
                            "expression": "(ctx.properties.var2 || 0) * 2",
                            "after": false
                        }
                    }
                ],
                "after": false
            }
        }
    ]
}